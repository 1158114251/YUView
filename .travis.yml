language: cpp

os:
  - linux
  - osx
dist:
  # Request Ubuntu 14 as linux
  - trusty
compiler: 
  - gcc
  
# safelist
branches:
  only:
    - deployment
    
before_install:
  # Setup the repository. Qt 5.7 on linux. The latest qt5 version on mac.
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo add-apt-repository ppa:beineri/opt-qt571-trusty -y; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get update -qq; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew update; fi
  # On linux also get a newer g++. The old one won't work.
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo add-apt-repository -y ppa:ubuntu-toolchain-r/test; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get update -qq; fi
  
install:
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get install -qq qt57base; source /opt/qt57/bin/qt57-env.sh; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew install qt5; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew link --force qt5; fi
  # On linux, install the new g++ version
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo apt-get install -qq g++-6; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-6 90; fi

script:
  # Run qmake and make
  - qmake -config release
  - make
  - ls -alh
  - ls -alh build
  - ls -alh build/release
  - if [[ ${TRAVIS_OS_NAME} == osx ]]; then /usr/local/opt/qt5/bin/macdeployqt build/release/YUView.app -always-overwrite -verbose=2;fi
  - if [[ ${TRAVIS_OS_NAME} == osx ]]; then otool -L build/release/YUView.app/Contents/MacOs/YUView; fi
  
before_deploy:
  # empty
deploy:
  # We need the compiled files
  # skip_cleanup: true
  # Here we can deploy. Or it could be done in the before_deploy or after_success steps.
